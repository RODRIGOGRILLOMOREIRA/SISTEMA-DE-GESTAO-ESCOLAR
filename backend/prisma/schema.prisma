generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              String            @id @default(uuid())
  nome            String
  email           String            @unique
  senha           String
  tipo            String            @default("USUARIO") // ADMIN, USUARIO
  ativo           Boolean           @default(true)
  resetToken      String?
  resetTokenExpira DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("usuarios")
}

model Aluno {
  id              String            @id @default(uuid())
  nome            String
  cpf             String            @unique
  dataNascimento  DateTime
  email           String            @unique
  telefone        String?
  endereco        String?
  responsavel     String
  telefoneResp    String
  turmaId         String?
  turma           Turma?            @relation(fields: [turmaId], references: [id])
  matriculas      Matricula[]
  notas           Nota[]
  frequencias     Frequencia[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("alunos")
}

model Professor {
  id              String            @id @default(uuid())
  nome            String
  cpf             String
  email           String
  telefone        String
  especialidade   String
  disciplinas     Disciplina[]
  turmas          Turma[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("professores")
}

model Turma {
  id              String            @id @default(uuid())
  nome            String
  ano             Int
  periodo         String            // Manhã, Tarde, Noite
  professorId     String?
  professor       Professor?        @relation(fields: [professorId], references: [id])
  alunos          Aluno[]
  disciplinas     Disciplina[]
  matriculas      Matricula[]
  frequencias     Frequencia[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("turmas")
}

model Disciplina {
  id              String            @id @default(uuid())
  nome            String
  cargaHoraria    Int
  professorId     String?
  professor       Professor?        @relation(fields: [professorId], references: [id])
  turmas          Turma[]
  notas           Nota[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("disciplinas")
}

model Matricula {
  id              String            @id @default(uuid())
  alunoId         String
  aluno           Aluno             @relation(fields: [alunoId], references: [id])
  turmaId         String
  turma           Turma             @relation(fields: [turmaId], references: [id])
  dataMatricula   DateTime          @default(now())
  status          String            @default("ATIVA") // ATIVA, CANCELADA, CONCLUIDA
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("matriculas")
}

model Nota {
  id              String            @id @default(uuid())
  alunoId         String
  aluno           Aluno             @relation(fields: [alunoId], references: [id])
  disciplinaId    String
  disciplina      Disciplina        @relation(fields: [disciplinaId], references: [id])
  trimestre       Int               // 1, 2, 3
  avaliacao01     Float?            // 0.0 a 10.0
  avaliacao02     Float?            // 0.0 a 10.0
  avaliacao03     Float?            // 0.0 a 10.0
  mediaM1         Float?            // Soma das 3 avaliações
  avaliacaoEAC    Float?            // Momento 2 - EAC
  notaFinalTrimestre Float?         // Maior nota entre mediaM1 e avaliacaoEAC
  observacao      String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@unique([alunoId, disciplinaId, trimestre])
  @@map("notas")
}

model NotaFinal {
  id              String            @id @default(uuid())
  alunoId         String
  disciplinaId    String
  trimestre1      Float?            // Nota final do 1º trimestre
  trimestre2      Float?            // Nota final do 2º trimestre
  trimestre3      Float?            // Nota final do 3º trimestre
  mediaFinal      Float?            // (T1*1 + T2*2 + T3*3) / 6
  aprovado        Boolean           @default(false) // true se mediaFinal >= 6.0
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@unique([alunoId, disciplinaId])
  @@map("notas_finais")
}

model Frequencia {
  id              String            @id @default(uuid())
  alunoId         String
  aluno           Aluno             @relation(fields: [alunoId], references: [id])
  turmaId         String
  turma           Turma             @relation(fields: [turmaId], references: [id])
  data            DateTime
  presente        Boolean           @default(true)
  observacao      String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("frequencias")
}

model Configuracao {
  id              String            @id @default(uuid())
  nomeEscola      String
  redeEscolar     String?
  endereco        String
  telefone        String?
  email           String?
  logoUrl         String?
  temaModo        String            @default("light") // light ou dark
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("configuracoes")
}
